---
title: "Using JWT and Refresh Tokens for Secure and Persistent User Sessions"
description: "Learn how to implement JWT and refresh tokens to maintain secure and persistent user sessions in web applications, similar to platforms like LinkedIn."
image: "../../public/blog-images/reactCleanCode.jpg"
publishedAt: "2024-09-15"
updatedAt: "2024-09-15"
author: "JC Ashley"
isPublished: true
tags: 
- JWT
- Security
- Web Development
- Authentication
---

## Introduction

Implementing secure session management is crucial in modern web applications. JSON Web Tokens (JWT) and refresh tokens provide a robust solution for maintaining user sessions effectively. This guide will walk you through implementing both in a Node.js application using Express, demonstrating how major platforms like LinkedIn might manage sessions.

## What is JWT?

JWT, or JSON Web Token, is a compact, URL-safe means of representing claims to be exchanged between two parties. It is particularly useful for authentication and information exchange in web applications.

## Setting Up JWT Authentication

Let’s start by setting up a simple Node.js server that uses JWT for authentication:

```javascript
const express = require('express');
const jwt = require('jsonwebtoken');
require('dotenv').config();

const app = express();
app.use(express.json());

const accessTokenSecret = process.env.ACCESS_TOKEN_SECRET;

app.post('/login', (req, res) => {
  const { username } = req.body;
  const user = { name: username };
  const accessToken = jwt.sign(user, accessTokenSecret, { expiresIn: '20m' });
  res.json({ accessToken });
});

app.get('/protected', authenticateToken, (req, res) => {
  res.json({ message: "Welcome to the protected route!" });
});

function authenticateToken(req, res, next) {
  const authHeader = req.headers['authorization'];
  const token = authHeader && authHeader.split(' ')[1];
  if (token == null) return res.sendStatus(401);

  jwt.verify(token, accessTokenSecret, (err, user) => {
    if (err) return res.sendStatus(403);
    req.user = user;
    next();
  });
});

const PORT = 3000;
app.listen(PORT, () => {
  console.log(`Server running on http://localhost:${PORT}`);
});
```

### Implementing Refresh Tokens

Now, let’s add the capability to use refresh tokens to obtain new access tokens without needing the user to log in again:


```javascript
const refreshTokenSecret = process.env.REFRESH_TOKEN_SECRET;
let refreshTokens = []; // This should ideally be managed in a more persistent way.

app.post('/token', (req, res) => {
  const refreshToken = req.body.token;
  if (refreshToken == null) return res.sendStatus(401);
  if (!refreshTokens.includes(refreshToken)) return res.sendStatus(403);

  jwt.verify(refreshToken, refreshTokenSecret, (err, user) => {
    if (err) return res.sendStatus(403);
    const newAccessToken = jwt.sign({ name: user.name }, accessTokenSecret, { expiresIn: '20m' });
    res.json({ accessToken: newAccessToken });
  });
});

app.post('/logout', (req, res) => {
  refreshTokens = refreshTokens.filter(token => token !== req.body.token);
  res.sendStatus(204);
});

```

## Conclusion
By implementing JWTs and refresh tokens, you enhance the security and usability of your web applications. Users can maintain their sessions over extended periods securely, similar to how platforms like LinkedIn handle user sessions. Make sure to manage and store these tokens securely to prevent unauthorized access and potential security breaches.