---
title: "Using JWT and Refresh Tokens for Secure and Persistent User Sessions"
description: "Learn how to implement JWT and refresh tokens to maintain secure and persistent user sessions in web applications, similar to platforms like LinkedIn."
image: "../../public/blog-images/reactCleanCode.jpg"
publishedAt: "2024-09-1"
updatedAt: "2024-09-15"
author: "JC Ashley"
isPublished: true
tags: 
- JWT
- Security
- Web Development
- Authentication
---

## Introduction

Implementing secure session management is crucial in modern web applications. JSON Web Tokens (JWT) and refresh tokens provide a robust solution for maintaining user sessions effectively. This guide will walk you through implementing both in a Node.js application using Express, demonstrating how major platforms like LinkedIn might manage sessions.

## What is JWT?

JWT, or JSON Web Token, is a compact, URL-safe means of representing claims to be exchanged between two parties. It is particularly useful for authentication and information exchange in web applications.

## Setting Up JWT Authentication

Let’s start by setting up a simple Node.js server that uses JWT for authentication:

```javascript
const express = require('express');
const jwt = require('jsonwebtoken');
require('dotenv').config();

const app = express();
app.use(express.json());

const accessTokenSecret = process.env.ACCESS_TOKEN_SECRET;

app.post('/login', (req, res) => {
  const { username } = req.body;
  const user = { name: username };
  const accessToken = jwt.sign(user, accessTokenSecret, { expiresIn: '20m' });
  res.json({ accessToken });
});

app.get('/protected', authenticateToken, (req, res) => {
  res.json({ message: "Welcome to the protected route!" });
});

function authenticateToken(req, res, next) {
  const authHeader = req.headers['authorization'];
  const token = authHeader && authHeader.split(' ')[1];
  if (token == null) return res.sendStatus(401);

  jwt.verify(token, accessTokenSecret, (err, user) => {
    if (err) return res.sendStatus(403);
    req.user = user;
    next();
  });
});

const PORT = 3000;
app.listen(PORT, () => {
  console.log(`Server running on http://localhost:${PORT}`);
});
```

## What This JWT Part Does
### The server we just set up does a few things in simple terms:

- User Login: When a user logs in, the server verifies their credentials. Once verified, it creates a JWT—a small piece of data that proves the user has logged in successfully.
- Access-Controlled Routes: The server uses this token to check if the user is allowed to access certain parts of the application. It’s like a stamp on your hand at a concert, showing security that you’ve paid and can enter.

## Transitioning to Refresh Tokens
While JWTs are excellent for short-term validation, what happens when you want the user to stay logged in over extended periods without compromising security? This is where refresh tokens come into play.

Refresh tokens allow users to obtain new access tokens without the need to log in again and again. It's ideal for applications where user sessions need to be maintained securely but don't handle extremely sensitive data, like a social media site or a content platform.

### Implementing Refresh Tokens

Now, let’s add the capability to use refresh tokens to obtain new access tokens without needing the user to log in again:


```javascript
const refreshTokenSecret = process.env.REFRESH_TOKEN_SECRET;
let refreshTokens = []; // This should ideally be managed in a more persistent way.

app.post('/token', (req, res) => {
  const refreshToken = req.body.token;
  if (refreshToken == null) return res.sendStatus(401);
  if (!refreshTokens.includes(refreshToken)) return res.sendStatus(403);

  jwt.verify(refreshToken, refreshTokenSecret, (err, user) => {
    if (err) return res.sendStatus(403);
    const newAccessToken = jwt.sign({ name: user.name }, accessTokenSecret, { expiresIn: '20m' });
    res.json({ accessToken: newAccessToken });
  });
});

app.post('/logout', (req, res) => {
  refreshTokens = refreshTokens.filter(token => token !== req.body.token);
  res.sendStatus(204);
});

```
### How Refresh Tokens Work
- Longer Session Management: Refresh tokens are used to generate new access tokens. Imagine you have a pass that lets you come and go in a secure area. Instead of getting a new pass each time, you show your refresh token to quickly get a new pass.
- Security and Convenience: They strike a balance between maintaining security and providing convenience by minimizing the need for frequent logins.

## Conclusion
By implementing JWTs and refresh tokens, you enhance the security and usability of your web applications. Users can maintain their sessions over extended periods securely, similar to how platforms like LinkedIn handle user sessions. Make sure to manage and store these tokens securely to prevent unauthorized access and potential security breaches.